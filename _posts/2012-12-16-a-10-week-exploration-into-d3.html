--- 
layout: post
title: A 10 week exploration into D3
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "27826612"
  _oembed_12239121539e0e2dce37d3b09edc3475: "{{unknown}}"
  _oembed_f48acee0a3fde6b20298c883814581e4: "{{unknown}}"
  jabber_published: "1355690435"
  _publicize_pending: "1"
  _oembed_498da28a0569b7201c0ea043e0f9fceb: "{{unknown}}"
  _oembed_1a4c0a44fbcb6ae2bdbf9cfb050228a8: "{{unknown}}"
  email_notification: "1355690437"
  _oembed_a747ec89d70865e23f01ed63c684fc65: "{{unknown}}"
  _oembed_a5620da7c4b4528e39d88d7278785c98: "{{unknown}}"
  _oembed_5e80d80cb1db71581fe8560d1e7f7742: "{{unknown}}"
  _oembed_bfab90a289e26a34ef7154012fad65ff: "{{unknown}}"
  _oembed_e27b046968f9aba7bdd15c0f76435e27: "{{unknown}}"
  _oembed_f243fbb3b69a1aa1dfd995b16c15922a: "{{unknown}}"
  _oembed_8b61e0bc7de02205661443125e9499fd: "{{unknown}}"
  _oembed_028069dcceedd1e80802f35d28408df6: "{{unknown}}"
  _oembed_12c4ae544c64ce9f34a512c6e04ad839: "{{unknown}}"
  _oembed_c8144bfae2338e01a957ad6ac7c35573: "{{unknown}}"
  _oembed_d6959c96d38250c44543a5f1d1d7e93c: "{{unknown}}"
  _oembed_707152e027ed7e139eef189614d63288: "{{unknown}}"
  _oembed_5c6cde754dbb9fc6df4338c77739c6a8: "{{unknown}}"
  _oembed_b2b4b6ffd07e678acf57a024cbfa41b8: "{{unknown}}"
  _oembed_b779ffdbd2b116e1263a3a4f29490a0d: "{{unknown}}"
  _oembed_2a4856dab30eaecbd22e0fd1fabc67f1: "{{unknown}}"
---
Ten weeks ago I was introduced to D3.js in my data visualization class. I was blown away in the very first minute when the professor presented these <a href="https://github.com/mbostock/d3/wiki/Gallery">examples</a>. I had no idea the web was capable of such rich visualizations. The best part too is that D3 is not extremely hard to pick up. Granted some experience with javascript is necessary, but the visualizations shown in the examples aren't nearly as difficult as they look.

<b>What I made</b>

<span style="text-decoration:underline;"><em>London 2012</em></span>

My very first visualization was a static one:

<a href="http://pennyhacks.com/2012/12/16/a-10-week-exploration-into-d3/london2012/#main" rel="attachment wp-att-445"><img class="aligncenter size-full wp-image-445" alt="London2012" src="http://pennyhacks.files.wordpress.com/2012/12/london2012.png" width="440" height="328" /></a>

This visualization is a scatter plot of 2012 Olympic countries' medal count vs their per capita income. The radius of the data points is proportionate to the number of people that country sent, and the pie chart is the break down of gold, silver and bronze medals.

This project was a hack. I had no idea how to use D3 and was just aiming to get something to work. Those pie charts are all carefully crafted path elements. This sort of thing is made easy by the D3 library and you should never ever see "M" "L" or "Z" in your D3 code when creating paths. I didn't take advantage of D3's capabilities and ended up creating long, hard-to-read path declarations. Here's a snippet taken directly from my javascript file that should <span style="text-decoration:underline;">never be used</span>:
<pre> path = "M" + startPoint.x + " " + startPoint.y +
        " L" + (startPoint.x + radius) + " " + (startPoint.y) +
        " A" + radius + " " + radius + " 0 " + longArc + " 0 " + 
             endX + " " + endY +
        " Z"</pre>
In addition, you can even see on the yaxis that the label is vertical text facing the wrong direction. I was a sad man and couldn't rotate the text the other way without it ending up somewhere way off the page. This poor fellow ran into my same <a href="http://stackoverflow.com/questions/11252753/rotate-x-axis-text-in-d3">problem</a>, but had the sense to ask on stackoverflow.

<span style="text-decoration:underline;"><em>Refugee Flows</em></span>

For my next project, I decided to try making an interactive map. I found a bunch of data on this <a href="http://data.un.org/">UN site</a> about where refugees originate from and where they are seeking asylum. This seemed to be screaming for some sort of map visualization. So I made this:

http://refugeeflows.herokuapp.com/

<a href="http://pennyhacks.com/2012/12/16/a-10-week-exploration-into-d3/screen-shot-2012-12-14-at-3-49-30-pm/#main" rel="attachment wp-att-454"><img class="aligncenter size-full wp-image-454" alt="Refugee flows" src="http://pennyhacks.files.wordpress.com/2012/12/screen-shot-2012-12-14-at-3-49-30-pm.png" width="440" height="300" /></a>

This was a great exercise for my first interactive visualization. D3 makes it extremely easy to do mapping. All in all, the project took around 10 hours to complete and I learned loads more about SVG.

<span style="text-decoration:underline;"><em>Student Surveys</em></span>

I made this one with a partner. We chose to visualize a huge chunk of student survey data. The students were in 8th grade when the survey started and there was a second round conducted when the students were in 10th grade. Our main purpose for this visualization was to tell a story. We ended up deciding that parallel coordinates was the best way to communicate the information we found most intriguing.

http://studentsurveys.herokuapp.com/

<a href="http://pennyhacks.com/2012/12/16/a-10-week-exploration-into-d3/screen-shot-2012-12-14-at-4-25-13-pm/#main" rel="attachment wp-att-457"><img class="aligncenter size-full wp-image-457" alt="studentsurveys" src="http://pennyhacks.files.wordpress.com/2012/12/screen-shot-2012-12-14-at-4-25-13-pm.png" width="525" height="314" /></a>

Our visualization was built on top of one of parellel coordinate examples in the D3 gallery. This was great because we got to really understand a well made D3 example and then extend it to fit our needs. It also introduced me to <a href="http://en.wikipedia.org/wiki/Brushing_and_linking">brushing and linking</a>, which is a great tool for visualizing huge datasets.

<span style="text-decoration:underline;"><em>African refugee populations</em></span>

After digging deeper into the UNHCR (United Nations High Commissioner for Refugees) database, I found even more interesting data albeit in a worse format. I found <a href="http://vis.stanford.edu/wrangler/app/">Data Wrangler</a> an invaluable tool when formatting the data.

http://africanrefugees.herokuapp.com/

<a href="http://pennyhacks.com/2012/12/16/a-10-week-exploration-into-d3/screen-shot-2012-12-16-at-11-55-18-am/#main" rel="attachment wp-att-462"><img class="aligncenter size-full wp-image-462" alt="African refugee populations" src="http://pennyhacks.files.wordpress.com/2012/12/screen-shot-2012-12-16-at-11-55-18-am.png" width="525" height="406" /></a>

This particular visualization required loads of brushing and linking which was a lot of fun to do in D3. I used a very "object oriented" javascript approach with a world object that linked all of my separate visualizations with each other. I also got to play with the GoogleMaps API for the first time. This vis taught me just how hard it is to keep all the graphics within a page and make it still look clean.

<span style="text-decoration:underline;"><em>Diabetes Visualization</em></span>

For my final visualization, I worked with a partner again to visualize 4 years worth blood glucose levels, sampled every 5 minutes, from an actual diabetic patient. We worked closely with a clinician and a father of a diabetic patient to construct a useful representation of the data.

http://diabetesvis.herokuapp.com/

<a href="http://pennyhacks.com/2012/12/16/a-10-week-exploration-into-d3/screen-shot-2012-12-16-at-12-04-50-pm/#main" rel="attachment wp-att-464"><img class="aligncenter size-full wp-image-464" alt="Diabetes visualization" src="http://pennyhacks.files.wordpress.com/2012/12/screen-shot-2012-12-16-at-12-04-50-pm.png" width="525" height="293" /></a>

Once again, brushing and linking was essential for this visualization. By now, Reno, my partner, and I had become fluent enough in D3 to code most of what we envisioned; the hardest part of this project was making it responsive. We had almost 300,000 data points yet we needed our application to be snappy. Since our dataset wasn't changing, we took advantage using lots of indexes on the database. Also during this endeavor, we learned how painful it is to work with dates. To mitigate some of the nastiness, we found a nice date library for rails called <a href="https://github.com/radar/by_star">by_star</a>. Also essential was this <a href="http://www.dotnetguy.co.uk/post/2011/10/31/convert-dates-between-ruby-and-javascript/">blog post</a> about converting javascript dates to ruby dates. By the end of this project we were ready to start a petition to remove time zones from the world.
